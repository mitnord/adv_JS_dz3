(()=>{"use strict";class t{constructor(t){this.list=t}getList(){return this.list}find(t){const s=this.list.findIndex((s=>s.id===t));return s>=0&&this.list[s]}remove(t){const s=this.list.findIndex((s=>s.id===t));return s>=0&&(this.list=[...this.list.slice(0,s),...this.list.slice(s+1)],!0)}}const s=new class{constructor(t){this.apiUrl=t}getCatalog(t,s){this.send(s,t,`${this.apiUrl}/catalog`)}getCart(t,s){this.send(s,t,`${this.apiUrl}/cart`)}addToCart(t,s,e){this.send(s,t,`${this.apiUrl}/cart`,"POST",JSON.stringify(e),{"Content-Type":"application/json"})}removeFromCart(t,s,e){this.send(s,t,`${this.apiUrl}/cart`,"DELETE",JSON.stringify(e),{"Content-Type":"application/json"})}send(t,s,e,i="GET",a="",c={},r=6e4){let n;window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.timeout=r,n.ontimeout=t,n.onreadystatechange=function(){4===n.readyState&&(n.status<400?s(n.responseText):n.status>=400&&t(n.status))},n.open(i,e,!0);for(const[t,s]of Object.entries(c))n.setRequestHeader(t,s);n.send(a)}}("http://localhost:3000/api/v1"),e=new class{constructor(){this.callbacks={}}subscribe(t,s){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(s)}emit(t,s){this.callbacks[t]&&this.callbacks[t].forEach((t=>{t(s)}))}},i=new class extends t{constructor(t,s){super([]),this.api=t,this.eventEmmiter=s}fetch(t){this.api.getCart((t=>{this.list=JSON.parse(t),this.eventEmmiter.emit("cartFeched",this.list)}),t)}add(t,s){this.api.addToCart((()=>{this.list.push(t)}),s,t)}remove(t,s){this.find(t)&&this.api.removeFromCart((()=>{this.remove(t)}),s,this.list[index])}}(s,e),a=new class extends t{constructor(t,s,e){super([]),this.api=t,this.cart=e,this.eventEmmiter=s}fetch(t){this.api.getCatalog((t=>{this.list=JSON.parse(t),this.eventEmmiter.emit("showcaseFeched",this.list)}),t)}buy(t,s){const e=this.find(t);e&&cart.add(e,s)}}(s,e,i);e.subscribe("showcaseFeched",(t=>{console.log(t)})),e.subscribe("cartFeched",(t=>{console.log(t)})),a.fetch(),i.fetch()})();